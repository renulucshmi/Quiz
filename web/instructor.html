<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Instructor Panel - Remote Polling</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes pulse {
        0%, 100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes float {
        0%, 100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      @keyframes shimmer {
        0% {
          background-position: -1000px 0;
        }
        100% {
          background-position: 1000px 0;
        }
      }

      @keyframes ripple {
        0% {
          transform: scale(0);
          opacity: 1;
        }
        100% {
          transform: scale(4);
          opacity: 0;
        }
      }

      @keyframes glow {
        0%, 100% {
          box-shadow: 0 0 20px rgba(56, 189, 248, 0.3);
        }
        50% {
          box-shadow: 0 0 30px rgba(56, 189, 248, 0.6);
        }
      }

      .animate-fadeIn {
        animation: fadeIn 0.5s ease-out;
      }

      .animate-pulse-custom {
        animation: pulse 2s infinite;
      }

      .animate-slideIn {
        animation: slideIn 0.3s ease-out;
      }

      .animate-float {
        animation: float 3s ease-in-out infinite;
      }

      .glass-card {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      }

      .glass-light {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      .gradient-bg {
        background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 50%, #312e81 100%);
        position: relative;
        overflow-x: hidden;
        overflow-y: auto;
      }

      .gradient-bg::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%);
        animation: float 20s ease-in-out infinite;
      }

      .btn-ripple {
        position: relative;
        overflow: hidden;
      }

      .btn-ripple::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.4);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }

      .btn-ripple:active::after {
        width: 300px;
        height: 300px;
      }

      .loading-spinner {
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top: 3px solid white;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .gradient-border {
        position: relative;
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(147, 51, 234, 0.3));
        padding: 2px;
        border-radius: 0.75rem;
      }

      .gradient-border-inner {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: calc(0.75rem - 2px);
      }

      input:focus, select:focus {
        animation: glow 2s ease-in-out infinite;
      }

      /* Style for select dropdown options */
      select option {
        background-color: #1e3a8a;
        color: white;
        padding: 10px;
      }

      select option:hover {
        background-color: #2563eb;
      }

      /* Smooth transitions for all state changes */
      * {
        transition-property: background-color, border-color, color, fill, stroke, opacity, box-shadow, transform;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* Custom scrollbar - Always visible */
      ::-webkit-scrollbar {
        width: 12px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(30, 58, 138, 0.3);
        border-radius: 10px;
        margin: 4px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(147, 51, 234, 0.8));
        border-radius: 10px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 0 15px rgba(59, 130, 246, 0.5), inset 0 0 10px rgba(255, 255, 255, 0.1);
      }

      ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, rgba(59, 130, 246, 1), rgba(147, 51, 234, 1));
        box-shadow: 0 0 20px rgba(59, 130, 246, 0.8), inset 0 0 15px rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.3);
      }

      ::-webkit-scrollbar-thumb:active {
        background: linear-gradient(135deg, rgba(96, 165, 250, 1), rgba(168, 85, 247, 1));
      }

      /* Force scrollbar to always show */
      html {
        overflow-y: scroll;
      }

      body {
        overflow-y: auto;
      }

      /* For Firefox */
      * {
        scrollbar-width: thin;
        scrollbar-color: rgba(59, 130, 246, 0.8) rgba(30, 58, 138, 0.3);
      }
    </style>
  </head>
  <body class="gradient-bg min-h-screen p-4 md:p-6">
    <div class="max-w-7xl mx-auto">
      <!-- Header -->
      <div class="text-center mb-8 animate-fadeIn">
        <div class="flex items-center justify-center gap-3 mb-3">
          <svg class="w-10 h-10 text-white animate-float" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
          </svg>
          <h1 class="text-4xl md:text-5xl font-bold text-white">Instructor Control Panel</h1>
        </div>
        <p class="text-white/80 text-lg">Remote Classroom Polling System</p>
      </div>

      <!-- Alert -->
      <div id="alert" class="hidden mb-6 rounded-xl px-5 py-4 text-sm transition-all duration-300 animate-slideIn"></div>

      <!-- Main Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- Create Poll Panel -->
        <div class="glass-card rounded-2xl p-6 md:p-8 animate-fadeIn hover:shadow-[0_8px_40px_rgba(59,130,246,0.4)] transition-shadow duration-500">
          <div class="flex items-center gap-3 mb-6">
            <svg class="w-6 h-6 text-sky-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
            </svg>
            <h2 class="text-2xl font-semibold text-white">Create New Poll</h2>
          </div>

          <div class="space-y-4">
            <div>
              <label for="question" class="block text-white/90 font-medium mb-2">Poll Question</label>
              <div class="gradient-border">
                <input
                  type="text"
                  id="question"
                  placeholder="e.g., What is 2+2?"
                  class="w-full gradient-border-inner border-0 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:outline-none transition-all duration-300"
                  autofocus
                />
              </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div>
                <label for="optionA" class="block text-white/90 font-medium mb-2">Option A</label>
                <div class="gradient-border">
                  <input
                    type="text"
                    id="optionA"
                    placeholder="Option A"
                    class="w-full gradient-border-inner border-0 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:outline-none transition-all duration-300"
                  />
                </div>
              </div>
              <div>
                <label for="optionB" class="block text-white/90 font-medium mb-2">Option B</label>
                <div class="gradient-border">
                  <input
                    type="text"
                    id="optionB"
                    placeholder="Option B"
                    class="w-full gradient-border-inner border-0 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:outline-none transition-all duration-300"
                  />
                </div>
              </div>
              <div>
                <label for="optionC" class="block text-white/90 font-medium mb-2">Option C</label>
                <div class="gradient-border">
                  <input
                    type="text"
                    id="optionC"
                    placeholder="Option C"
                    class="w-full gradient-border-inner border-0 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:outline-none transition-all duration-300"
                  />
                </div>
              </div>
              <div>
                <label for="optionD" class="block text-white/90 font-medium mb-2">Option D</label>
                <div class="gradient-border">
                  <input
                    type="text"
                    id="optionD"
                    placeholder="Option D"
                    class="w-full gradient-border-inner border-0 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:outline-none transition-all duration-300"
                  />
                </div>
              </div>
            </div>

            <div>
              <label for="correct" class="block text-white/90 font-medium mb-2">Correct Answer</label>
              <div class="gradient-border">
                <select
                  id="correct"
                  class="w-full gradient-border-inner border-0 rounded-lg px-4 py-3 text-white focus:outline-none transition-all duration-300 cursor-pointer"
                >
                  <option value="A">A</option>
                  <option value="B" selected>B</option>
                  <option value="C">C</option>
                  <option value="D">D</option>
                </select>
              </div>
            </div>

            <button
              onclick="createPoll()"
              class="w-full btn-ripple bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-xl px-5 py-3 font-medium transition-all duration-300 transform hover:scale-[1.02] hover:shadow-[0_10px_30px_rgba(59,130,246,0.5)] active:scale-95 flex items-center justify-center gap-2"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
              </svg>
              <span>Create Poll</span>
            </button>
          </div>
        </div>

        <!-- Connected Students Panel -->
        <div class="glass-card rounded-2xl p-6 md:p-8 animate-fadeIn hover:shadow-[0_8px_40px_rgba(59,130,246,0.4)] transition-shadow duration-500">
          <div class="flex items-center gap-3 mb-6">
            <svg class="w-6 h-6 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
            <h2 class="text-2xl font-semibold text-white">Connected Students</h2>
            <span class="ml-auto bg-sky-500/20 text-sky-300 px-3 py-1 rounded-full text-sm font-medium border border-sky-400/50">
              <span id="studentCount">0</span>
            </span>
          </div>

          <div id="studentsList" class="space-y-2 max-h-96 overflow-y-auto pr-2">
            <div class="text-center py-12 text-white/60">
              <svg class="w-16 h-16 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
              </svg>
              <p>No students connected yet</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Statistics Panel -->
      <div class="glass-card rounded-2xl p-6 md:p-8 mb-6 animate-fadeIn hover:shadow-[0_8px_40px_rgba(59,130,246,0.4)] transition-shadow duration-500">
        <div class="flex items-center gap-3 mb-6">
          <svg class="w-6 h-6 text-violet-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
          </svg>
          <h2 class="text-2xl font-semibold text-white">Poll Statistics</h2>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
          <div class="glass-light rounded-xl p-5 text-center border border-white/20 hover:border-white/40 transition-all duration-300">
            <div class="text-3xl font-bold text-sky-400 mb-2" id="statStudents">0</div>
            <div class="text-white/70 text-sm">Students</div>
          </div>
          <div class="glass-light rounded-xl p-5 text-center border border-white/20 hover:border-white/40 transition-all duration-300">
            <div class="text-3xl font-bold text-emerald-400 mb-2" id="statVotes">0</div>
            <div class="text-white/70 text-sm">Total Votes</div>
          </div>
          <div class="glass-light rounded-xl p-5 text-center border border-white/20 hover:border-white/40 transition-all duration-300">
            <div class="text-3xl font-bold text-violet-400 mb-2" id="statPolls">0</div>
            <div class="text-white/70 text-sm">Polls Created</div>
          </div>
          <div class="glass-light rounded-xl p-5 text-center border border-white/20 hover:border-white/40 transition-all duration-300">
            <div class="mb-2">
              <span id="pollStatus" class="inline-block px-3 py-1.5 rounded-full text-xs font-medium bg-white/20 text-white/60 border border-white/30">
                INACTIVE
              </span>
            </div>
            <div class="text-white/70 text-sm">Poll Status</div>
          </div>
        </div>

        <div id="currentPollDisplay" class="hidden animate-slideIn">
          <div class="glass-light rounded-xl p-5 mb-5 border-l-4 border-sky-400">
            <h3 class="text-white font-semibold mb-3 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              Current Poll
            </h3>
            <div class="text-white text-lg mb-4 leading-relaxed" id="currentQuestion"></div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3" id="currentOptions"></div>
          </div>

          <div class="flex flex-wrap gap-3">
            <button
              id="startBtn"
              onclick="startPoll()"
              class="btn-ripple bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-700 hover:to-emerald-800 text-white rounded-xl px-5 py-3 font-medium transition-all duration-300 transform hover:scale-[1.02] hover:shadow-[0_10px_30px_rgba(16,185,129,0.5)] active:scale-95 flex items-center gap-2"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              <span>Start Poll</span>
            </button>
            <button
              id="endBtn"
              onclick="endPoll()"
              disabled
              class="btn-ripple bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-700 hover:to-amber-800 disabled:from-white/20 disabled:to-white/20 disabled:cursor-not-allowed text-white rounded-xl px-5 py-3 font-medium transition-all duration-300 transform hover:scale-[1.02] hover:shadow-[0_10px_30px_rgba(245,158,11,0.5)] active:scale-95 flex items-center gap-2"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"/>
              </svg>
              <span>End Poll</span>
            </button>
            <button
              id="revealBtn"
              onclick="revealAnswer()"
              disabled
              class="btn-ripple bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 disabled:from-white/20 disabled:to-white/20 disabled:cursor-not-allowed text-white rounded-xl px-5 py-3 font-medium transition-all duration-300 transform hover:scale-[1.02] hover:shadow-[0_10px_30px_rgba(59,130,246,0.5)] active:scale-95 flex items-center gap-2"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
              </svg>
              <span>Reveal Answer</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Quiz Questions Panel (NEW) -->
      <div class="glass-card rounded-2xl p-6 md:p-8 mb-6 animate-fadeIn hover:shadow-[0_8px_40px_rgba(59,130,246,0.4)] transition-shadow duration-500">
        <div class="flex items-center gap-3 mb-6">
          <svg class="w-6 h-6 text-sky-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"/>
          </svg>
          <h2 class="text-2xl font-semibold text-white">Quiz Questions</h2>
          <span class="ml-auto bg-sky-500/20 text-sky-300 px-3 py-1 rounded-full text-sm font-medium border border-sky-400/50">
            <span id="quizCount">0</span>
          </span>
        </div>

        <div id="pollsList" class="space-y-2 max-h-96 overflow-y-auto pr-2">
          <div class="text-center py-10 text-white/60">
            <svg class="w-12 h-12 mx-auto mb-2 opacity-60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3M3 11h18M5 19h14a2 2 0 002-2v-6H3v6a2 2 0 002 2z"/>
            </svg>
            <p>No questions added yet</p>
          </div>
        </div>
      </div>

      <!-- Chat Management Panel -->
      <div class="glass-card rounded-2xl p-6 md:p-8 mb-6 animate-fadeIn hover:shadow-[0_8px_40px_rgba(59,130,246,0.4)] transition-shadow duration-500">
        <div class="flex items-center gap-3 mb-6">
          <svg class="w-6 h-6 text-rose-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
          </svg>
          <h2 class="text-2xl font-semibold text-white">Chat Management</h2>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
          <div class="glass-light rounded-xl p-5 text-center border border-white/20">
            <div class="text-3xl font-bold text-rose-400 mb-2" id="chatMessages">0</div>
            <div class="text-white/70 text-sm">Messages</div>
          </div>
          <div class="glass-light rounded-xl p-5 text-center border border-white/20">
            <div class="mb-2">
              <span id="chatStatus" class="inline-block px-3 py-1.5 rounded-full text-xs font-medium bg-white/20 text-white/60 border border-white/30">
                DISABLED
              </span>
            </div>
            <div class="text-white/70 text-sm">Chat Status</div>
          </div>
        </div>

        <div class="flex flex-wrap gap-3">
          <button
            onclick="enableChat()"
            class="btn-ripple bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-700 hover:to-emerald-800 text-white rounded-xl px-5 py-3 font-medium transition-all duration-300 transform hover:scale-[1.02] hover:shadow-[0_10px_30px_rgba(16,185,129,0.5)] active:scale-95 flex items-center gap-2"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            <span>Enable Chat</span>
          </button>
          <button
            onclick="disableChat()"
            class="btn-ripple bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-700 hover:to-amber-800 text-white rounded-xl px-5 py-3 font-medium transition-all duration-300 transform hover:scale-[1.02] hover:shadow-[0_10px_30px_rgba(245,158,11,0.5)] active:scale-95 flex items-center gap-2"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
            <span>Disable Chat</span>
          </button>
          <button
            onclick="clearChat()"
            class="btn-ripple bg-gradient-to-r from-rose-600 to-rose-700 hover:from-rose-700 hover:to-rose-800 text-white rounded-xl px-5 py-3 font-medium transition-all duration-300 transform hover:scale-[1.02] hover:shadow-[0_10px_30px_rgba(244,63,94,0.5)] active:scale-95 flex items-center gap-2"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
            </svg>
            <span>Clear Chat</span>
          </button>
          <button
            onclick="openChatWindow()"
            class="btn-ripple bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-xl px-5 py-3 font-medium transition-all duration-300 transform hover:scale-[1.02] hover:shadow-[0_10px_30px_rgba(59,130,246,0.5)] active:scale-95 flex items-center gap-2"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
            </svg>
            <span>Open Chat Room</span>
          </button>
        </div>
      </div>
    </div>

    <script>
      let pollsCreated = 0;
      let currentPoll = null;

      function showAlert(message, type) {
        const alert = document.getElementById("alert");
        alert.className = "mb-6 rounded-xl px-5 py-4 text-sm transition-all duration-300 animate-slideIn";
        
        if (type === "success") {
          alert.className += " bg-emerald-500/20 text-emerald-300 border border-emerald-400/50";
        } else if (type === "error") {
          alert.className += " bg-rose-500/20 text-rose-300 border border-rose-400/50";
        } else if (type === "info") {
          alert.className += " bg-sky-500/20 text-sky-300 border border-sky-400/50";
        }
        
        alert.textContent = message;
        alert.classList.remove("hidden");
        
        setTimeout(() => {
          alert.classList.add("hidden");
        }, 5000);
      }

      function createPoll() {
        const question = document.getElementById("question").value.trim();
        const optionA = document.getElementById("optionA").value.trim();
        const optionB = document.getElementById("optionB").value.trim();
        const optionC = document.getElementById("optionC").value.trim();
        const optionD = document.getElementById("optionD").value.trim();
        const correct = document.getElementById("correct").value;

        if (!question || !optionA || !optionB || !optionC || !optionD) {
          showAlert("Please fill in all fields", "error");
          return;
        }

        const pollData = {
          question: question,
          options: [optionA, optionB, optionC, optionD],
          correct: correct,
        };

        fetch("/instructor/create", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(pollData),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showAlert("Poll created successfully! ✓", "success");

              // Store the poll data (server returns pollId, we have local data)
              currentPoll = {
                pollId: data.pollId,
                question: question,
                options: [optionA, optionB, optionC, optionD],
                correct: correct,
              };

              pollsCreated++;
              document.getElementById("statPolls").textContent = pollsCreated;
              displayCurrentPoll();
              clearForm();
              updateStats(); // Refresh to show new poll in list
            } else {
              showAlert(data.message || "Failed to create poll", "error");
            }
          })
          .catch((error) => {
            showAlert("Error creating poll", "error");
          });
      }

      function displayCurrentPoll() {
        document.getElementById("currentPollDisplay").classList.remove("hidden");
        document.getElementById("currentQuestion").textContent = currentPoll.question;

        const optionsContainer = document.getElementById("currentOptions");
        optionsContainer.innerHTML = "";

        currentPoll.options.forEach((option, index) => {
          const letter = String.fromCharCode(65 + index);
          const div = document.createElement("div");
          div.className = "glass-light rounded-lg px-4 py-3 border transition-all duration-300";
          
          if (letter === currentPoll.correct) {
            div.className += " border-emerald-400/50 bg-emerald-500/10";
          } else {
            div.className += " border-white/20";
          }
          
          div.innerHTML = `<span class="text-white font-medium">${letter}.</span> <span class="text-white/90">${option}</span>`;
          optionsContainer.appendChild(div);
        });

        document.getElementById("startBtn").disabled = false;
      }

      function startPoll() {
        fetch("/instructor/start", { method: "POST" })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showAlert("Poll started! Students can now answer.", "success");
              const statusBadge = document.getElementById("pollStatus");
              statusBadge.textContent = "ACTIVE";
              statusBadge.className = "inline-block px-3 py-1.5 rounded-full text-xs font-medium bg-emerald-500/20 text-emerald-300 border border-emerald-400/50 animate-pulse-custom";
              document.getElementById("startBtn").disabled = true;
              document.getElementById("endBtn").disabled = false;
            }
          });
      }

      function endPoll() {
        fetch("/instructor/end", { method: "POST" })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showAlert("Poll ended! No more answers accepted.", "info");
              const statusBadge = document.getElementById("pollStatus");
              statusBadge.textContent = "INACTIVE";
              statusBadge.className = "inline-block px-3 py-1.5 rounded-full text-xs font-medium bg-white/20 text-white/60 border border-white/30";
              document.getElementById("endBtn").disabled = true;
              document.getElementById("revealBtn").disabled = false;
            }
          });
      }

      function revealAnswer() {
        fetch("/instructor/reveal", { method: "POST" })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showAlert("Correct answer revealed! Check the dashboard.", "success");
              document.getElementById("revealBtn").disabled = true;
            }
          });
      }

      function clearForm() {
        document.getElementById("question").value = "";
        document.getElementById("optionA").value = "";
        document.getElementById("optionB").value = "";
        document.getElementById("optionC").value = "";
        document.getElementById("optionD").value = "";
        document.getElementById("correct").value = "B";
      }

      function renderPollsList(polls) {
        const list = document.getElementById("pollsList");
        const count = Array.isArray(polls) ? polls.length : 0;
        document.getElementById("quizCount").textContent = count;
        document.getElementById("statPolls").textContent = count;

        if (!polls || polls.length === 0) {
          list.innerHTML = `
            <div class="text-center py-10 text-white/60">
              <svg class="w-12 h-12 mx-auto mb-2 opacity-60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3M3 11h18M5 19h14a2 2 0 002-2v-6H3v6a2 2 0 002 2z"/>
              </svg>
              <p>No questions added yet</p>
            </div>
          `;
          return;
        }

        // Determine which poll is currently selected (from server data)
        let currentPollId = null;
        if (window.statsData && window.statsData.currentPoll) {
          currentPollId = window.statsData.currentPoll.pollId;
        }

        const rows = polls.map((p, idx) => {
          const isActive = p.active;
          const isRevealed = p.revealed;
          const isCurrentlySelected = currentPollId === p.pollId;

          const statusBadge = isActive
            ? '<span class="px-2 py-0.5 rounded-full text-xs bg-emerald-500/20 text-emerald-300 border border-emerald-400/50">ACTIVE</span>'
            : '<span class="px-2 py-0.5 rounded-full text-xs bg-white/20 text-white/60 border border-white/30">INACTIVE</span>';

          const revealBadge = isRevealed
            ? '<span class="px-2 py-0.5 rounded-full text-xs bg-blue-500/20 text-blue-300 border border-blue-400/50">REVEALED</span>'
            : '';

          const selectedBadge = isCurrentlySelected
            ? '<span class="px-2 py-0.5 rounded-full text-xs bg-violet-500/20 text-violet-300 border border-violet-400/50">★ SELECTED</span>'
            : '';

          const optionsHtml = (p.options || []).map((opt, i) => {
            const letter = String.fromCharCode(65 + i);
            const correct = p.correct === letter;
            return `
              <div class="text-sm px-2 py-1 rounded border ${correct ? 'border-emerald-400/50 bg-emerald-500/10 text-emerald-300' : 'border-white/20 text-white/80'}">
                <span class="font-semibold text-sky-300">${letter}.</span> ${opt}
              </div>
            `;
          }).join('');

          // Select button (show if not currently selected)
          const selectButton = !isCurrentlySelected
            ? `<button onclick="selectPoll('${p.pollId}')" class="px-3 py-1.5 text-xs rounded-lg bg-violet-500/20 text-violet-300 border border-violet-400/50 hover:bg-violet-500/30 transition-all">
                Select
              </button>`
            : '';

          // Highlight border if selected
          const borderClass = isCurrentlySelected
            ? 'border-violet-400/50 bg-violet-500/5'
            : 'border-white/20';

          return `
            <div class="glass-light rounded-xl px-4 py-3 border ${borderClass} hover:border-white/40 transition-all duration-300">
              <div class="flex items-start justify-between gap-3 mb-3">
                <div class="flex-1">
                  <div class="text-white font-medium mb-2">Q${idx + 1}: ${p.question}</div>
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                    ${optionsHtml}
                  </div>
                </div>
                <div class="flex flex-col items-end gap-1">
                  ${statusBadge}
                  ${revealBadge}
                  ${selectedBadge}
                </div>
              </div>
              ${selectButton ? `<div class="flex justify-end">${selectButton}</div>` : ''}
            </div>
          `;
        }).join('');

        list.innerHTML = rows;
      }

      function selectPoll(pollId) {
        fetch("/instructor/select", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ pollId: pollId }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showAlert("Poll selected! Use Start/End/Reveal buttons below.", "info");
              updateStats(); // Refresh to show selection and update button states
            } else {
              showAlert(data.error || "Failed to select poll", "error");
            }
          })
          .catch((error) => {
            showAlert("Error: " + error.message, "error");
          });
      }

      function updateStats() {
        fetch("/instructor/stats")
          .then((response) => response.json())
          .then((data) => {
            console.log("Stats response:", data);

            // Store globally for poll selection highlighting
            window.statsData = data;

            // Update counts
            const studentCount = data.totalStudents || 0;
            document.getElementById("studentCount").textContent = studentCount;
            document.getElementById("statStudents").textContent = studentCount;
            document.getElementById("statVotes").textContent = data.totalVotes || 0;

            // Update polls created + list
            const polls = data.polls || [];
            renderPollsList(polls);

            // Update poll status badge from currentPoll if provided
            const statusBadge = document.getElementById("pollStatus");
            const startBtn = document.getElementById("startBtn");
            const endBtn = document.getElementById("endBtn");
            const revealBtn = document.getElementById("revealBtn");

            if (data.currentPoll) {
              if (data.currentPoll.active) {
                statusBadge.textContent = "ACTIVE";
                statusBadge.className = "inline-block px-3 py-1.5 rounded-full text-xs font-medium bg-emerald-500/20 text-emerald-300 border border-emerald-400/50 animate-pulse-custom";
                // Poll is active: disable start, enable end
                startBtn.disabled = true;
                endBtn.disabled = false;
                revealBtn.disabled = true;
              } else {
                statusBadge.textContent = "INACTIVE";
                statusBadge.className = "inline-block px-3 py-1.5 rounded-full text-xs font-medium bg-white/20 text-white/60 border border-white/30";
                // Poll is inactive: enable start, disable end, enable reveal if not already revealed
                startBtn.disabled = false;
                endBtn.disabled = true;
                revealBtn.disabled = data.currentPoll.revealed ? true : false;
              }

              // Reflect current poll question (basic)
              const cpd = document.getElementById("currentPollDisplay");
              const cq = document.getElementById("currentQuestion");
              if (cpd && cq && data.currentPoll.question) {
                cpd.classList.remove("hidden");
                cq.textContent = data.currentPoll.question;

                // Update current poll options display
                // Find the full poll data from polls array
                const fullPoll = (data.polls || []).find(p => p.pollId === data.currentPoll.pollId);
                if (fullPoll) {
                  const optionsContainer = document.getElementById("currentOptions");
                  optionsContainer.innerHTML = "";

                  (fullPoll.options || []).forEach((option, index) => {
                    const letter = String.fromCharCode(65 + index);
                    const div = document.createElement("div");
                    div.className = "glass-light rounded-lg px-4 py-3 border transition-all duration-300";

                    if (letter === fullPoll.correct) {
                      div.className += " border-emerald-400/50 bg-emerald-500/10";
                    } else {
                      div.className += " border-white/20";
                    }

                    div.innerHTML = `<span class="text-white font-medium">${letter}.</span> <span class="text-white/90">${option}</span>`;
                    optionsContainer.appendChild(div);
                  });
                }
              }
            }

            // Update students list
            const studentsList = document.getElementById("studentsList");
            if (data.students && data.students.length > 0) {
              studentsList.innerHTML = data.students
                .map((student) => {
                  const studentName = student.name || student;
                  const answered = student.answered ? "\u2713" : "\u25cb";
                  return `
                    <div class="glass-light rounded-xl px-4 py-3 border border-white/20 hover:border-white/40 transition-all duration-300 flex items-center justify-between">
                      <div class="flex items-center gap-3">
                        <svg class="w-5 h-5 text-white/70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span class="text-white font-medium">${studentName}</span>
                      </div>
                      <span class="bg-emerald-500/20 text-emerald-300 px-3 py-1 rounded-full text-xs font-medium border border-emerald-400/50 flex items-center gap-1.5">
                        <span class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse-custom"></span>
                        ${answered} Online
                      </span>
                    </div>
                  `;
                })
                .join("");
            } else {
              studentsList.innerHTML = `
                <div class="text-center py-12 text-white/60">
                  <svg class="w-16 h-16 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                  </svg>
                  <p>No students connected yet</p>
                </div>
              `;
            }
          })
          .catch((error) => {
            console.error("Error updating stats:", error);
          });
      }

      // Update stats every 2 seconds
      setInterval(updateStats, 2000);
      updateStats();

      // Chat management functions
      function enableChat() {
        fetch("/chat/enable", { method: "POST" })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showAlert("Chat enabled for discussion!", "success");
              updateChatStatus();
            }
          })
          .catch((error) => {
            showAlert("Error enabling chat", "error");
          });
      }

      function disableChat() {
        fetch("/chat/disable", { method: "POST" })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showAlert("Chat disabled", "info");
              updateChatStatus();
            }
          })
          .catch((error) => {
            showAlert("Error disabling chat", "error");
          });
      }

      function clearChat() {
        if (confirm("Are you sure you want to clear all chat messages?")) {
          fetch("/chat/clear", { method: "POST" })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                showAlert("Chat history cleared", "success");
                updateChatStatus();
              }
            })
            .catch((error) => {
              showAlert("Error clearing chat", "error");
            });
        }
      }

      function openChatWindow() {
        window.open("chat.html", "ChatRoom", "width=900,height=700");
      }

      function updateChatStatus() {
        fetch("/chat/status")
          .then((response) => response.json())
          .then((data) => {
            document.getElementById("chatMessages").textContent = data.totalMessages || 0;

            const statusBadge = document.getElementById("chatStatus");
            if (data.enabled) {
              statusBadge.textContent = "ENABLED";
              statusBadge.className = "inline-block px-3 py-1.5 rounded-full text-xs font-medium bg-emerald-500/20 text-emerald-300 border border-emerald-400/50";
            } else {
              statusBadge.textContent = "DISABLED";
              statusBadge.className = "inline-block px-3 py-1.5 rounded-full text-xs font-medium bg-white/20 text-white/60 border border-white/30";
            }
          })
          .catch((error) => {
            console.error("Error updating chat status:", error);
          });
      }

      // Update stats and chat status periodically
      setInterval(updateChatStatus, 3000);
      updateChatStatus();
    </script>
  </body>
</html>
