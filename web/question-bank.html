<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Question Bank - Remote Classroom</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          135deg,
          #1e40af 0%,
          #1e3a8a 50%,
          #312e81 100%
        );
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        color: white;
        margin-bottom: 30px;
      }

      header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      nav {
        margin-top: 15px;
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }

      nav a {
        color: white;
        text-decoration: none;
        padding: 8px 16px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s;
      }

      nav a:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
      }

      .content {
        position: relative;
        z-index: 1;
      }

      .filters {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      }

      .filters-grid {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr auto;
        gap: 15px;
        align-items: end;
      }

      .filter-group label {
        display: block;
        font-weight: bold;
        margin-bottom: 5px;
        color: white;
      }

      .filter-group input,
      .filter-group select {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        color: white;
        font-size: 1em;
        transition: border-color 0.3s;
      }

      .filter-group input::placeholder {
        color: rgba(255, 255, 255, 0.6);
      }

      .filter-group input:focus,
      .filter-group select:focus {
        outline: none;
        border-color: #60a5fa;
        box-shadow: 0 0 20px rgba(56, 189, 248, 0.3);
      }

      .filter-group select option {
        background: #1e3a8a;
        color: white;
      }

      .btn {
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        color: white;
      }

      .btn-primary {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      }

      .btn-primary:hover {
        transform: translateY(-2px) scale(1.02);
        box-shadow: 0 10px 30px rgba(59, 130, 246, 0.5);
      }

      .question-list {
        display: grid;
        gap: 15px;
      }

      .question-card {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        transition: all 0.3s;
      }

      .question-card:hover {
        border-color: rgba(96, 165, 250, 0.6);
        box-shadow: 0 8px 40px rgba(59, 130, 246, 0.4);
      }

      .question-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .question-id {
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        padding: 6px 12px;
        border-radius: 6px;
        font-family: monospace;
        font-size: 12px;
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      .question-tags {
        display: flex;
        gap: 5px;
        flex-wrap: wrap;
      }

      .tag {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 12px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .difficulty-badge {
        padding: 6px 14px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: bold;
      }

      .difficulty-EASY {
        background: rgba(16, 185, 129, 0.3);
        color: #6ee7b7;
        border: 1px solid rgba(16, 185, 129, 0.5);
      }

      .difficulty-MEDIUM {
        background: rgba(251, 146, 60, 0.3);
        color: #fdba74;
        border: 1px solid rgba(251, 146, 60, 0.5);
      }

      .difficulty-HARD {
        background: rgba(239, 68, 68, 0.3);
        color: #fca5a5;
        border: 1px solid rgba(239, 68, 68, 0.5);
      }

      .question-text {
        font-size: 16px;
        font-weight: bold;
        margin: 15px 0;
        color: white;
      }

      .options-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin: 15px 0;
      }

      .option {
        padding: 12px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
      }

      .option.correct {
        background: rgba(16, 185, 129, 0.2);
        border-color: #10b981;
        font-weight: bold;
        color: #6ee7b7;
      }

      .option-label {
        font-weight: bold;
        color: rgba(255, 255, 255, 0.8);
        margin-right: 5px;
      }

      .question-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
      }

      .question-meta {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.8);
      }

      .question-actions {
        display: flex;
        gap: 10px;
      }

      .btn-small {
        padding: 8px 16px;
        font-size: 14px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
        color: white;
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      }

      .btn-small:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
      }

      .btn-danger {
        background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
      }

      .btn-danger:hover {
        box-shadow: 0 8px 20px rgba(244, 67, 54, 0.4);
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: rgba(255, 255, 255, 0.8);
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .empty-state h2 {
        color: white;
      }

      .empty-state a {
        color: #60a5fa;
        text-decoration: none;
        font-weight: bold;
      }

      .empty-state a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1
          style="
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
          "
        >
          <svg width="32" height="32" fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm-4 4H9v-2h6v2zm4-8H9V5h10v2z"
            />
          </svg>
          Question Bank
        </h1>
        <nav>
          <a href="index.html">Home</a>
          <a href="mcq-batch.html">Create MCQs</a>
          <a href="quiz-builder.html">Quiz Builder</a>
          <a href="instructor.html">Instructor</a>
        </nav>
      </header>

      <div class="content">
        <div class="filters">
          <div class="filters-grid">
            <div class="filter-group">
              <label>Search</label>
              <input
                type="text"
                id="searchInput"
                placeholder="Search questions, options, tags..."
              />
            </div>
            <div class="filter-group">
              <label>Tag</label>
              <input type="text" id="tagFilter" placeholder="Filter by tag" />
            </div>
            <div class="filter-group">
              <label>Difficulty</label>
              <select id="difficultyFilter">
                <option value="">All</option>
                <option value="EASY">Easy</option>
                <option value="MEDIUM">Medium</option>
                <option value="HARD">Hard</option>
              </select>
            </div>
            <div>
              <button
                onclick="loadQuestions()"
                class="btn btn-primary"
                style="display: flex; align-items: center; gap: 8px"
              >
                <svg
                  width="18"
                  height="18"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                  />
                </svg>
                Search
              </button>
            </div>
          </div>
        </div>

        <div id="questionList" class="question-list">
          <!-- Questions will be loaded here -->
        </div>
      </div>
    </div>

    <script>
      const API_BASE = "http://localhost:8090";

      // Load questions on page load
      window.onload = function () {
        loadQuestions();
      };

      async function loadQuestions() {
        const search = document.getElementById("searchInput").value.trim();
        const tag = document.getElementById("tagFilter").value.trim();
        const difficulty = document.getElementById("difficultyFilter").value;

        // Build query string
        let queryParams = [];
        if (search) queryParams.push(`q=${encodeURIComponent(search)}`);
        if (tag) queryParams.push(`tag=${encodeURIComponent(tag)}`);
        if (difficulty) queryParams.push(`difficulty=${difficulty}`);

        const queryString =
          queryParams.length > 0 ? "?" + queryParams.join("&") : "";

        try {
          const response = await fetch(
            `${API_BASE}/api/questions${queryString}`
          );
          const data = await response.json();

          if (response.ok) {
            displayQuestions(data.questions || []);
          } else {
            console.error("Failed to load questions:", data);
          }
        } catch (error) {
          console.error("Network error:", error);
        }
      }

      function displayQuestions(questions) {
        const container = document.getElementById("questionList");

        if (questions.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <h2>No Questions Found</h2>
                        <p>Create some questions using the <a href="mcq-batch.html">MCQ Batch Creator</a>.</p>
                    </div>
                `;
          return;
        }

        container.innerHTML = questions
          .map((q) => createQuestionCard(q))
          .join("");
      }

      function createQuestionCard(question) {
        const tags = question.tags
          .map((tag) => `<span class="tag">${tag}</span>`)
          .join("");
        const options = question.options
          .map((opt, idx) => {
            const isCorrect = idx === question.correctIndex;
            const letter = String.fromCharCode(65 + idx); // A, B, C, D
            return `
                    <div class="option ${isCorrect ? "correct" : ""}">
                        <span class="option-label">${letter})</span>
                        ${opt}
                    </div>
                `;
          })
          .join("");

        const timeInfo = question.timeLimitSeconds
          ? `Time: ${question.timeLimitSeconds}s`
          : "No time limit";

        return `
                <div class="question-card">
                    <div class="question-header">
                        <span class="question-id">${question.id}</span>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <span class="difficulty-badge difficulty-${question.difficulty}">${question.difficulty}</span>
                            <div class="question-tags">${tags}</div>
                        </div>
                    </div>

                    <div class="question-text">${question.text}</div>

                    <div class="options-grid">
                        ${options}
                    </div>

                    <div class="question-footer">
                        <div class="question-meta">
                            Correct: ${question.correctAnswer} | ${timeInfo}
                        </div>
                        <div class="question-actions">
                            <button onclick="editQuestion('${question.id}')" class="btn btn-small" style="display: flex; align-items: center; gap: 5px;">
                                <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                </svg>
                                Edit
                            </button>
                            <button onclick="deleteQuestion('${question.id}')" class="btn btn-small btn-danger" style="display: flex; align-items: center; gap: 5px;">
                                <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                </svg>
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            `;
      }

      function editQuestion(questionId) {
        // Simple implementation: redirect to edit page or show modal
        alert(
          "Edit functionality: In a full implementation, this would open an edit form for question " +
            questionId
        );
        // You could implement inline editing or a modal dialog here
      }

      async function deleteQuestion(questionId) {
        if (!confirm("Are you sure you want to delete this question?")) {
          return;
        }

        try {
          const response = await fetch(
            `${API_BASE}/api/questions/${questionId}`,
            {
              method: "DELETE",
            }
          );

          const data = await response.json();

          if (response.ok && data.success) {
            alert("Question deleted successfully");
            loadQuestions(); // Reload the list
          } else {
            alert("Failed to delete question: " + (data.error || data.message));
          }
        } catch (error) {
          alert("‚ùå Network error: " + error.message);
        }
      }
    </script>
  </body>
</html>
